<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 ‰πùÂ∑ûÂÜ¨Êó•‰πãÊóÖ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@600;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.6);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --primary-text: #2c3e50;
            --accent-pink: #D65A73;
            --starlux-gold: #CFA972;
            --btn-glass: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.5));
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            color: var(--primary-text);
            background: linear-gradient(125deg, #e0c3fc 0%, #8ec5fc 40%, #fbc2eb 70%, #a18cd1 100%);
            background-size: 300% 300%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            padding-bottom: 120px;
            overflow-x: hidden;
            position: relative;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; }
        }

        #falling-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
        .falling-item { position: absolute; top: -50px; animation: fall linear infinite; }
        .snowflake { color: rgba(255, 255, 255, 0.9); filter: drop-shadow(0 0 2px rgba(255,255,255,0.6)); }
        .sakura { color: rgba(255, 183, 197, 0.95); filter: drop-shadow(0 0 2px rgba(255, 183, 197, 0.6)); }
        @keyframes fall {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; } 90% { opacity: 0.9; }
            100% { transform: translateY(105vh) translateX(30px) rotate(360deg); opacity: 0; }
        }

        /* Header */
        header {
            position: relative; padding: 60px 20px 40px 20px; text-align: center; overflow: hidden; z-index: 999;
            box-shadow: 0 4px 30px rgba(0,0,0,0.1); border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        header::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://images.unsplash.com/photo-1624606733226-97e349ddbd7c?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center 30%; z-index: -2;
        }
        header::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.4); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            z-index: -1; mask-image: linear-gradient(to bottom, black 40%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }
        header h1 { font-family: 'Noto Serif TC', serif; font-size: 2rem; font-weight: 900; color: #222; text-shadow: 0 2px 15px rgba(255,255,255,0.9); margin-bottom: 5px; }
        header p { font-size: 0.95rem; color: #333; font-weight: 700; letter-spacing: 3px; text-shadow: 0 1px 5px rgba(255,255,255,0.8); }

        .main-container { padding: 25px 20px; max-width: 600px; margin: 0 auto; position: relative; z-index: 10; }
        .tab-content { display: none; animation: slideUp 0.4s ease-out; }
        .tab-content.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* UI Components */
        .section-header-styled {
            text-align: center; padding: 20px; margin-bottom: 25px;
            background: rgba(255, 255, 255, 0.3); border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center;
        }
        .section-header-icon { font-size: 2rem; color: var(--accent-pink); margin-bottom: 8px; animation: floatIcon 3s ease-in-out infinite; }
        .section-header-text { font-family: 'Noto Serif TC'; font-size: 1.4rem; font-weight: 800; color: #2c3e50; }
        @keyframes floatIcon { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .card {
            background: var(--glass-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 20px; border: 1px solid var(--glass-border); box-shadow: var(--glass-shadow);
            margin-bottom: 25px; overflow: hidden; position: relative;
        }
        .card-body { padding: 20px; }
        .card-title { font-family: 'Noto Serif TC'; font-size: 1.2rem; font-weight: 800; color: #222; margin-bottom: 8px; display:flex; align-items:center; }
        .card-desc { font-size: 0.95rem; color: #444; line-height: 1.6; white-space: pre-wrap; margin-bottom: 12px; }

        .btn-map {
            display: inline-block; justify-content: center; align-items: center;
            background: var(--btn-glass); border: 1px solid rgba(255,255,255,0.8);
            color: var(--accent-pink); padding: 8px 20px; border-radius: 50px;
            text-decoration: none; font-size: 0.9rem; font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer;
        }

        .card-actions { position: absolute; top: 15px; right: 15px; display: flex; gap: 8px; }
        .btn-icon-action {
            width: 32px; height: 32px; border-radius: 50%; background: rgba(255,255,255,0.6);
            display: flex; align-items: center; justify-content: center;
            color: #666; cursor: pointer; transition: all 0.2s; border: 1px solid rgba(255,255,255,0.8);
        }
        .btn-icon-action:hover { background: #fff; color: var(--accent-pink); transform: scale(1.1); }
        .btn-icon-action.delete:hover { color: #ff6b6b; }

        .add-buttons-container { display: flex; gap: 10px; justify-content: center; margin-bottom: 40px; }
        .btn-add-trip {
            background: rgba(255,255,255,0.5); border: 1px solid #fff; padding: 12px 30px;
            border-radius: 15px; color: #555; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 5px; transition: 0.2s; width: 100%; justify-content: center;
        }
        .btn-add-trip:hover { background: #fff; color: var(--accent-pink); transform: translateY(-2px); }

        .traffic-warning {
            margin: 0 0 20px 20px; border: 2px dashed rgba(214, 90, 115, 0.4); border-radius: 15px; padding: 10px;
            text-align: center; color: var(--accent-pink); font-size: 0.9rem; cursor: pointer;
            background: rgba(255,255,255,0.2); transition: all 0.2s;
        }
        .traffic-warning:hover { background: rgba(255,255,255,0.6); transform: scale(1.02); }

        /* Tabelog Badge */
        .tabelog-badge {
            display: inline-flex; align-items: center; 
            background: #fff4e6; color: #fa8514; border: 1px solid #ffe8cc;
            padding: 2px 8px; border-radius: 6px; font-weight: bold; font-size: 0.85rem; 
            margin-bottom: 8px; width: fit-content;
        }
        .tabelog-badge i { margin-right: 4px; }

        /* Timeline */
        .timeline { position: relative; padding-left: 30px; }
        .timeline-item { position: relative; margin-bottom: 20px; }
        .timeline-item::before { content: ''; position: absolute; left: -36px; top: 20px; width: 12px; height: 12px; background: #fff; border: 3px solid var(--accent-pink); border-radius: 50%; z-index: 2; }
        .timeline-item::after { content: ''; position: absolute; left: -31px; top: 35px; bottom: -40px; width: 2px; background: rgba(255,255,255,0.6); z-index: 1; }
        
        .transit-container { position: relative; margin-bottom: 20px; padding-left: 10px; display: flex; align-items: center; }
        .transit-info { 
            display: inline-flex; align-items: center; background: rgba(255,255,255,0.6); 
            padding: 5px 12px; border-radius: 15px; font-size: 0.8rem; color: #444; 
            border: 1px solid rgba(255,255,255,0.5); flex: 1; max-width: fit-content;
        }
        .transit-icon { margin-right: 8px; color: var(--primary-text); }
        .transit-actions { display: flex; gap: 5px; margin-left: 10px; opacity: 0.6; }
        .transit-actions i { cursor: pointer; padding: 5px; font-size: 0.9rem; }
        .transit-actions i:hover { color: var(--accent-pink); opacity: 1; }

        /* Modal (Glass) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.1); z-index: 2000; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-glass {
            background: rgba(255, 255, 255, 0.4); width: 90%; max-width: 400px;
            padding: 25px; border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 30px 60px rgba(0,0,0,0.1); backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); transform: scale(0.9); transition: transform 0.3s;
        }
        .modal-overlay.show .modal-glass { transform: scale(1); }
        .modal-title { font-size: 1.3rem; font-weight: 800; color: #222; margin-bottom: 20px; text-align: center; }
        .modal-input-group { margin-bottom: 15px; }
        .modal-label { display: block; font-size: 0.9rem; font-weight: bold; color: #444; margin-bottom: 5px; }
        .modal-input, .modal-select {
            width: 100%; padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.5);
            font-size: 1rem; outline: none; background: rgba(255,255,255,0.4); color: #222;
        }
        .modal-input:focus { background: rgba(255,255,255,0.7); }
        .modal-btns { display: flex; gap: 10px; margin-top: 25px; }
        .btn-modal-save { flex: 1; padding: 12px; background: var(--accent-pink); color: white; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(214, 90, 115, 0.3); }
        .btn-modal-cancel { flex: 1; padding: 12px; background: rgba(255,255,255,0.5); color: #555; border: 1px solid #fff; border-radius: 15px; font-weight: bold; cursor: pointer; }

        /* Lists */
        .list-item, .shop-item { background: rgba(255,255,255,0.6); padding: 15px; margin-bottom: 10px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.4); display: flex; justify-content: space-between; align-items: center; }
        .shop-item { align-items: flex-start; }
        .shop-name { font-weight: 700; color: #333; font-size: 1.05rem; }
        .shop-note { font-size: 0.85rem; color: #666; margin-top: 4px; display: flex; align-items: center; }
        .shop-actions { display: flex; align-items: center; gap: 15px; margin-left: 10px;}
        .btn-link { color: var(--accent-pink); font-size: 1.2rem; }
        .btn-check { color: #ccc; font-size: 1.2rem; cursor: pointer; }
        .shop-item.checked .btn-check { color: var(--accent-pink); }
        .shop-item.checked .shop-name { text-decoration: line-through; opacity: 0.5; }
        .btn-trash { color: #aaa; font-size: 1rem; cursor: pointer; }
        .btn-add-block {
            width: 100%; padding: 15px; border-radius: 20px; background: rgba(255, 255, 255, 0.3); 
            border: 1px solid rgba(255,255,255,0.5); backdrop-filter: blur(10px);
            color: var(--primary-text); font-weight: bold; font-size: 1rem; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-top: 20px; transition: transform 0.2s;
        }
        .btn-add-block:active { transform: scale(0.98); background: rgba(255,255,255,0.6); }

        /* Other */
        .cover-card { background: rgba(255, 255, 255, 0.4); border-radius: 30px; padding: 40px 20px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.6); backdrop-filter: blur(15px); box-shadow: 0 20px 50px rgba(0,0,0,0.1); margin-top: 20px; }
        .cover-icon { font-size: 4rem; color: var(--accent-pink); margin-bottom: 20px; animation: floatIcon 4s ease-in-out infinite; }
        .btn-start { display: inline-block; width: 100%; padding: 18px; background: #333; color: white; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; border: none; }
        .starlux-card { background: rgba(30, 30, 30, 0.85); color: #fff; border: 1px solid #CFA972; }
        .starlux-card .card-title { color: #CFA972; } .starlux-card .card-desc { color: #ccc; }
        .flight-row { display: flex; justify-content: space-between; align-items: center; margin: 25px 0; position: relative; }
        .flight-code { font-size: 2rem; font-weight: 800; color: #CFA972; }
        .flight-path { flex: 1; height: 1px; background: rgba(207,169,114,0.6); margin: 0 20px; position: relative; }
        .plane-wrapper { position: absolute; top: -14px; left: 0; animation: fly-right 4s linear infinite; }
        .plane-icon { font-size: 1.5rem; line-height: 1; filter: drop-shadow(0 0 5px rgba(207,169,114,0.8)); }
        @keyframes fly-right { 0% { left: 0%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { left: 100%; opacity: 0; } }
        .bottom-nav { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 94%; max-width: 600px; height: 75px; background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 40px; border: 1px solid rgba(255, 255, 255, 0.6); box-shadow: 0 10px 30px rgba(0,0,0,0.15); display: flex; justify-content: space-between; align-items: center; padding: 0 10px; z-index: 1000; overflow-x: auto; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.65rem; color: #666; cursor: pointer; min-width: 50px; height: 55px; border-radius: 50%; flex-shrink: 0; transition: all 0.3s; }
        .nav-item.active { background: #fff; color: var(--accent-pink); transform: translateY(-10px) scale(1.1); box-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        .nav-item i { font-size: 1.2rem; margin-bottom: 3px; }
    </style>
</head>
<body>

    <div id="falling-container"></div>

    <header>
        <div style="font-size: 2.5rem; color: #333; margin-bottom: 10px; opacity: 0.8;">
            <i class="fas fa-torii-gate"></i>
        </div>
        <h1>‰πùÂ∑ûÂÜ¨Êó•‰πãÊóÖ</h1>
        <p>2026.01.05 - 01.09</p>
    </header>

    <div class="main-container">
        
        <div id="cover" class="tab-content active">
            <div class="cover-card">
                <i class="fas fa-snowflake cover-icon"></i>
                <div style="font-family:'Noto Serif TC'; font-size:1.8rem; font-weight:900; margin-bottom:10px;">‰πùÂ∑ûÂÜ¨Êó•‰πãÊóÖ</div>
                <div style="font-size:1.1rem; color:#555; margin-bottom:30px;">2026.01.05 - 01.09</div>
                <p style="color:#666; margin-bottom:30px;">Â∞èÂÄâÂüéÁöÑÈõ™ÊôØ„ÄÅÊöñÂëºÂëºÁöÑÊ∫´Ê≥â<br>ËàáÂçöÂ§öÁæéÈ£ü‰πãÊóÖ</p>
                <button class="btn-start" onclick="startJourney()">ÈñãÂßãÊóÖÁ®ã <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <div id="flight" class="tab-content">
            <div class="section-header-styled"><i class="fas fa-plane-departure section-header-icon"></i><div class="section-header-text">Ëà™Áè≠Ë≥áË®ä</div></div>
            <div class="card starlux-card">
                <div class="card-body">
                    <div class="card-title">ÂéªÁ®ã Outbound</div><div style="font-size:0.9rem; color:#aaa; margin-bottom:10px;">01/05 (‰∏Ä)</div>
                    <div class="flight-row">
                        <div><div class="flight-code">TPE</div><div style="color:#fff">07:30</div></div>
                        <div class="flight-path"><div class="plane-wrapper"><span class="plane-icon">‚úàÔ∏è</span></div></div>
                        <div style="text-align:right"><div class="flight-code">KMJ</div><div style="color:#fff">10:35</div></div>
                    </div>
                    <div class="card-desc"><strong>Starlux JX846</strong><br>Ê°ÉÂúí T1 - ÁÜäÊú¨</div>
                </div>
            </div>
            <div class="card starlux-card">
                <div class="card-body">
                    <div class="card-title">ËøîÁ®ã Inbound</div><div style="font-size:0.9rem; color:#aaa; margin-bottom:10px;">01/09 (‰∫î)</div>
                    <div class="flight-row">
                        <div><div class="flight-code">FUK</div><div style="color:#fff">19:10</div></div>
                        <div class="flight-path"><div class="plane-wrapper"><span class="plane-icon">‚úàÔ∏è</span></div></div>
                        <div style="text-align:right"><div class="flight-code">TPE</div><div style="color:#fff">20:50</div></div>
                    </div>
                    <div class="card-desc"><strong>Starlux JX841</strong><br>Á¶èÂ≤° Int - Ê°ÉÂúí T1</div>
                </div>
            </div>
        </div>

        <div id="hotel" class="tab-content">
            <div class="section-header-styled"><i class="fas fa-bed section-header-icon"></i><div class="section-header-text">‰ΩèÂÆøË≥áË®ä</div></div>
            <div class="card">
                <div class="card-body">
                    <div class="card-title">White Crystal</div>
                    <p class="card-desc">Á¶èÂ≤°Á∏£ / ÁÜäÊú¨Á∏£<br>Êú¨Ê¨°ÊóÖÁ®ã‰∏ªË¶Å‰ºëÊÜ©ËôïÔºåË´ãÁ¢∫Ë™çÊØèÊó•ÂÅúËªä‰ΩçÁΩÆ„ÄÇ</p>
                    <a href="https://www.google.com/maps/search/?api=1&query=White+Crystal+Hotel+Kyushu" target="_blank" class="btn-map"><i class="fas fa-location-arrow"></i> Google Map</a>
                </div>
            </div>
        </div>

        <div id="day1" class="tab-content"></div>
        <div id="day2" class="tab-content"></div>
        <div id="day3" class="tab-content"></div>
        <div id="day4" class="tab-content"></div>
        <div id="day5" class="tab-content"></div>

        <div id="shopping" class="tab-content">
            <div class="section-header-styled"><i class="fas fa-cart-plus section-header-icon"></i><div class="section-header-text">Ë≥ºË≤∑Ê∏ÖÂñÆ</div></div>
            <div id="shopping-list-container"></div>
            <button class="btn-add-block" onclick="openModal('shopping')"><i class="fas fa-plus"></i> Êñ∞Â¢ûÊ∏ÖÂñÆ</button>
        </div>

        <div id="expense" class="tab-content">
             <div class="section-header-styled"><i class="fas fa-wallet section-header-icon"></i><div class="section-header-text">Ë®òÂ∏≥Êú¨</div></div>
             <div style="background:linear-gradient(135deg,#FF9A9E,#FECFEF); color:#fff; padding:25px; border-radius:20px; text-align:center; margin-bottom:20px; box-shadow:0 10px 20px rgba(255,154,158,0.4);">
                 <p style="font-size:0.9rem">Á∏ΩÊîØÂá∫ (TWD)</p><div style="font-size:2rem; font-weight:900" id="total-twd">0</div>
             </div>
             <div style="text-align:right; margin-bottom:10px;">
                 <label style="font-weight:bold; color:#555">ÂåØÁéá: </label>
                 <input type="number" id="exchange-rate" value="0.22" step="0.001" style="width:80px; padding:5px; border-radius:8px; border:1px solid #ccc;">
             </div>
             <ul id="expense-list" style="list-style:none"></ul>
             <button class="btn-add-block" onclick="openModal('expense')"><i class="fas fa-plus"></i> Êñ∞Â¢ûÊîØÂá∫</button>
        </div>

        <div id="checklist" class="tab-content">
            <div class="section-header-styled"><i class="fas fa-clipboard-check section-header-icon"></i><div class="section-header-text">Ë°åÂâçÊ∫ñÂÇô</div></div>
            <div id="checklist-container"></div>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <input type="text" id="check-new" class="modal-input" placeholder="Êñ∞Â¢ûÂæÖËæ¶..." style="margin-bottom:0">
                <button class="btn-action" style="width:auto; padding:0 25px; margin:0;" onclick="addChecklistItem()">+</button>
            </div>
        </div>

    </div>

    <div id="universal-modal" class="modal-overlay">
        <div class="modal-glass">
            <div class="modal-title" id="uni-modal-title">Á∑®ËºØÈ†ÖÁõÆ</div>
            
            <div id="modal-fields-spot" style="display:none;">
                <div class="modal-input-group"><label class="modal-label">ÂêçÁ®±</label><input type="text" id="spot-title" class="modal-input"></div>
                <div class="modal-input-group"><label class="modal-label">Tabelog Ë©ïÂàÜ (ÈÅ∏Â°´)</label><input type="number" step="0.01" id="spot-score" class="modal-input" placeholder="‰æãÔºö3.58"></div>
                <div class="modal-input-group"><label class="modal-label">ÂÇôË®ª</label><textarea id="spot-desc" class="modal-input" rows="3"></textarea></div>
                <div class="modal-input-group"><label class="modal-label">Google Map</label><input type="text" id="spot-link" class="modal-input" placeholder="https://..."></div>
            </div>

            <div id="modal-fields-transit" style="display:none;">
                <div class="modal-input-group">
                    <label class="modal-label">‰∫§ÈÄöÊñπÂºè</label>
                    <select id="transit-icon" class="modal-select">
                        <option value="fa-car">üöó ÈñãËªä</option><option value="fa-train">üöÖ ÈõªËªä</option>
                        <option value="fa-walking">üö∂ Ê≠•Ë°å</option><option value="fa-bus">üöå Â∑¥Â£´</option>
                    </select>
                </div>
                <div class="modal-input-group"><label class="modal-label">ÊôÇÈñì/Ë™™Êòé</label><input type="text" id="transit-text" class="modal-input" placeholder="‰æãÔºö30 ÂàÜÈêò"></div>
            </div>

            <div id="modal-fields-shopping" style="display:none;">
                <div class="modal-input-group"><label class="modal-label">ÂïÜÂìÅÂêçÁ®±</label><input type="text" id="shop-modal-name" class="modal-input"></div>
                <div class="modal-input-group"><label class="modal-label">ÂÇôË®ª</label><input type="text" id="shop-modal-note" class="modal-input"></div>
                <div class="modal-input-group"><label class="modal-label">ÈÄ£Áµê/Âú∞Âúñ</label><input type="text" id="shop-modal-link" class="modal-input"></div>
            </div>

            <div id="modal-fields-expense" style="display:none;">
                <div class="modal-input-group"><label class="modal-label">È†ÖÁõÆÂêçÁ®±</label><input type="text" id="exp-modal-name" class="modal-input"></div>
                <div class="modal-input-group"><label class="modal-label">Êó•Âπ£ÈáëÈ°ç</label><input type="number" id="exp-modal-amt" class="modal-input"></div>
            </div>

            <div class="modal-btns">
                <button class="btn-modal-cancel" onclick="closeModal()">ÂèñÊ∂à</button>
                <button class="btn-modal-save" onclick="saveModalData()">ÂÑ≤Â≠ò</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('cover', this)"><i class="fas fa-home"></i><span>È¶ñÈ†Å</span></div>
        <div class="nav-item" onclick="switchTab('flight', this)"><i class="fas fa-plane"></i><span>Ëà™Áè≠</span></div>
        <div class="nav-item" onclick="switchTab('day1', this)"><i class="fas fa-calendar-day"></i><span>D1</span></div>
        <div class="nav-item" onclick="switchTab('day2', this)"><i class="fas fa-calendar-day"></i><span>D2</span></div>
        <div class="nav-item" onclick="switchTab('day3', this)"><i class="fas fa-calendar-day"></i><span>D3</span></div>
        <div class="nav-item" onclick="switchTab('day4', this)"><i class="fas fa-calendar-day"></i><span>D4</span></div>
        <div class="nav-item" onclick="switchTab('day5', this)"><i class="fas fa-calendar-day"></i><span>D5</span></div>
        <div class="nav-item" onclick="switchTab('shopping', this)"><i class="fas fa-cart-plus"></i><span>Êé°Ë≤∑</span></div>
        <div class="nav-item" onclick="switchTab('expense', this)"><i class="fas fa-calculator"></i><span>Ë®òÂ∏≥</span></div>
        <div class="nav-item" onclick="switchTab('checklist', this)"><i class="fas fa-check-square"></i><span>Ê∏ÖÂñÆ</span></div>
    </nav>

    <script>
        // --- Init Data (Corrected & Full) ---
        const INITIAL_ITINERARY = [
            {
                id: 'day1', title: 'Day 1 | ÁÜäÊú¨', icon: 'fa-chess-rook',
                items: [
                    {type:'spot', title:'ÁÜäÊú¨Âüé & Á®ªËç∑Á•ûÁ§æ', desc:'Êó•Êú¨‰∏âÂ§ßÂêçÂüé‰πã‰∏ÄÔºåÈªëËâ≤ÂüéÂ†°Â®ÅÈ¢®ÂáúÂáú„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=ÁÜäÊú¨Âüé'},
                    {type:'transit', icon:'fa-walking', text:'Ê≠•Ë°å 5 ÂàÜÈêò'},
                    {type:'spot', title:'Ê´ª‰πãÈ¶¨Â†¥ ÂüéÂΩ©Ëãë', desc:'Ê±üÊà∂È¢®ÊÉÖÂïÜÂ∫óË°óÔºåÊé®Ëñ¶„ÄåÊµ∑ËÜΩÂèØÊ®ÇÈ§Ö„Äç„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=Ê´ª‰πãÈ¶¨Â†¥+ÂüéÂΩ©Ëãë'},
                    {type:'transit', icon:'fa-train', text:'Â∏ÇÈõª 15 ÂàÜÈêò'},
                    {type:'spot', title:'ÂãùÁÉà‰∫≠ Êñ∞Â∏ÇË°óÊú¨Â∫ó', score:'3.78', desc:'ÈπøÂÖíÂ≥∂ÈªëË±öÁÇ∏Ë±¨ÊéíÔºåÁÜäÊú¨ÂøÖÂêÉ„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=ÂãùÁÉà‰∫≠+Êñ∞Â∏ÇË°óÊú¨Â∫ó'},
                    {type:'spot', title:'Check-in', desc:'ÂâçÂæÄ White Crystal Ëæ¶ÁêÜÂÖ•‰Ωè„ÄÇ', link:''}
                ]
            },
            {
                id: 'day2', title: 'Day 2 | Ëá™ÈßïËàáË≥ºÁâ©', icon: 'fa-car',
                items: [
                    {type:'spot', title:'ÁßüËªä (Nissan)', desc:'Ë´ãÂÇôÂ¶•ÔºöË≠∑ÁÖß„ÄÅÂè∞ÁÅ£ÈßïÁÖß„ÄÅÊó•ÊñáË≠ØÊú¨„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=Nissan+Rent-a-car+Hakataeki+Minami'},
                    {type:'transit', icon:'fa-car', text:'ËªäÁ®ã 40 ÂàÜÈêò'},
                    {type:'spot', title:'È≥•Ê†ñ PREMIUM OUTLETS', desc:'‰πùÂ∑ûÊúÄÂ§ß OutletÔºåÊ≠êÁæéÊó•Á≥ªÂìÅÁâåÈΩäÂÖ®„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=È≥•Ê†ñPREMIUM+OUTLETS'},
                    {type:'transit', icon:'fa-car', text:'ËªäÁ®ã 30 ÂàÜÈêò'},
                    {type:'spot', title:'‰πÖÁïôÁ±≥ & È´òËâØÂ§ßÁ§æ', desc:'ÊÑüÂèóÂú®Âú∞ÂïÜÂ∫óË°óÊ∞õÂúçÔºå‰øØÁû∞Á≠ëÂæåÂπ≥Âéü„ÄÇ', link:'googleusercontent.com/maps.google.com/52'},
                    {type:'transit', icon:'fa-car', text:'ËªäÁ®ã 50 ÂàÜÈêò'},
                    {type:'spot', title:'LaLaport Á¶èÂ≤°', desc:'ÂøÖÁúã 1:1 ÂØ¶È´îÂ§ßÈãºÂΩà„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=LaLaport+Á¶èÂ≤°'}
                ]
            },
            {
                id: 'day3', title: 'Day 3 | Â§™ÂÆ∞Â∫úËàáÁî±Â∏ÉÈô¢', icon: 'fa-torii-gate',
                items: [
                    {type:'spot', title:'‰∏ÄËò≠ÊãâÈ∫µ Â§™ÂÆ∞Â∫úÂèÉÈÅìÂ∫ó', score:'3.08', desc:'ÂÖ®ÁêÉÂîØ‰∏Ä‰∫îËßíÁ¢óÂêàÊ†ºÊãâÈ∫µ„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=‰∏ÄËò≠ÊãâÈ∫µ+Â§™ÂÆ∞Â∫úÂèÉÈÅìÂ∫ó'},
                    {type:'spot', title:'Â§™ÂÆ∞Â∫úÂ§©ÊªøÂÆÆ', desc:'ÂèÉÊãúÂ≠∏Âïè‰πãÁ•ûÔºåÂøÖÂêÉÊ¢ÖÊûùÈ§Ö„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=Â§™ÂÆ∞Â∫úÂ§©ÊªøÂÆÆ'},
                    {type:'transit', icon:'fa-car', text:'ËªäÁ®ã 1.5 Â∞èÊôÇ'},
                    {type:'spot', title:'Áî±Â∏ÉÈô¢Ê∫´Ê≥â', desc:'Êº´Ê≠•ÊπØ‰πãÂù™Ë°óÈÅìÔºåÊ¨£Ë≥ûÈáëÈ±óÊπñÁæéÊôØ„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=Áî±Â∏ÉÈô¢Ê∫´Ê≥â'},
                    {type:'transit', icon:'fa-car', text:'ËªäÁ®ã 1 Â∞èÊôÇ 40 ÂàÜ'},
                    {type:'spot', title:'ÁöøÂÄâÂ±±Á∫úËªä (Êñ∞Êó•Êú¨‰∏âÂ§ßÂ§úÊôØ)', desc:'Êê≠‰πòÁ∫úËªä‰∏äÂ±±ÔºåÂ∞áÂåó‰πùÂ∑ûÁπÅËèØÁáàÁÅ´Áõ°Êî∂ÁúºÂ∫ï„ÄÇ*Ë´ãÊ≥®ÊÑèÊú´Áè≠Á∫úËªäÊôÇÈñì', link:'usercontent.com/maps.google.com/53'}
                ]
            },
            {
                id: 'day4', title: 'Day 4 | ÂçöÂ§öÂ§©Á•ûÊï£Á≠ñ', icon: 'fa-city',
                items: [
                    {type:'spot', title:'Ëæ¶ÁêÜÈÇÑËªä', desc:'ÂâçÂæÄ Nissan Rent-a-car ÈÇÑËªä„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=Nissan+Rent-a-car'},
                    {type:'transit', icon:'fa-subway', text:'Âú∞ÈêµÁßªÂãï'},
                    {type:'spot', title:'ÂçàÈ§êÔºöShin-Shin', score:'3.58', desc:'ÂçöÂ§öÁ¥îÊÉÖË±öÈ™®ÊãâÈ∫µÔºåÊøÉÈÉÅ‰∏çËÜ©„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=ÂçöÂ§öÁ¥îÊÉÖÊãâÈ∫µ+Shin-Shin'},
                    {type:'spot', title:'Â§©Á•ûÂú∞‰∏ãË°ó & PARCO', desc:'‰πùÂ∑ûÊµÅË°å‰∏≠ÂøÉÔºåÂ•ΩÈÄõÂ•ΩË≤∑„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=Â§©Á•ûÂú∞‰∏ãË°ó'},
                    {type:'spot', title:'ÊôöÈ§êÔºöÁâõËÖ∏Èçã', score:'3.53', desc:'Êé®Ëñ¶ÂêçÂ∫ó„ÄåÂ§ßÂ±±„ÄçÊàñ„ÄåÂâçÁî∞Â±ã„Äç„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=ÂçöÂ§öÁâõËÖ∏Èçã'}
                ]
            },
            {
                id: 'day5', title: 'Day 5 | Êé°Ë≤∑ËàáËøîÁ®ã', icon: 'fa-shopping-bag',
                items: [
                    {type:'spot', title:'ÂçöÂ§öËªäÁ´ô AMU PLAZA', desc:'ÊúÄÂæå‰º¥ÊâãÁ¶ÆÔºöÂä™Âä™Èõû„ÄÅÂçöÂ§öÈÄöÈ•ÖÈ†≠„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=AMU+PLAZA+ÂçöÂ§ö'},
                    {type:'spot', title:'Ricoland Á¶èÂ≤°Ê©üÂ†¥Â∫ó', desc:'Ê©üËªäÈÉ®ÂìÅÂÖçÁ®ÖÊé°Ë≥ºËÅñÂú∞„ÄÇ', link:'https://www.google.com/maps/search/?api=1&query=Ricoland+Fukuoka+Airport'},
                    {type:'spot', title:'ÂâçÂæÄÁ¶èÂ≤°Ê©üÂ†¥ (FUK)', desc:'Êê≠‰πò JX841 (19:10) ËøîÂè∞„ÄÇ', link:'maps.google.com/36'}
                ]
            }
        ];

        // --- Core Logic (Update V6) ---
        const ITINERARY_KEY = 'trip_2026_itinerary_v6';
        let itineraryData = JSON.parse(localStorage.getItem(ITINERARY_KEY)) || INITIAL_ITINERARY;
        
        const SHOP_KEY = 'trip_2026_shop_v6';
        let shopData = JSON.parse(localStorage.getItem(SHOP_KEY)) || [];
        
        const EXP_KEY = 'trip_2026_exp_v6';
        let expenses = JSON.parse(localStorage.getItem(EXP_KEY)) || [];
        
        const CHECK_KEY = 'trip_2026_check_v6';
        let checks = JSON.parse(localStorage.getItem(CHECK_KEY)) || [{text:"Ë≠∑ÁÖß",checked:false}];

        let currentModalMode = ''; 
        let editTarget = { d: null, i: null, isEdit: false };

        // --- Render Itinerary ---
        function renderItinerary() {
            itineraryData.forEach((day, dayIdx) => {
                const container = document.getElementById(day.id);
                if (!container) return;
                
                let html = `
                    <div class="section-header-styled">
                        <i class="fas ${day.icon} section-header-icon"></i>
                        <div class="section-header-text">${day.title}</div>
                    </div>
                    <div class="timeline">`;

                day.items.forEach((item, itemIdx) => {
                    if(itemIdx > 0 && day.items[itemIdx-1].type === 'spot' && item.type === 'spot') {
                        html += `<div class="traffic-warning" onclick="openModal('transit', ${dayIdx}, ${itemIdx})"><i class="fas fa-exclamation-circle"></i> Êñ∞Â¢û‰∫§ÈÄöÊñπÂºè</div>`;
                    }

                    if (item.type === 'spot') {
                        let badgeHtml = item.score ? `<div class="tabelog-badge"><i class="fas fa-utensils"></i> tabelog ${item.score}</div>` : '';
                        html += `
                        <div class="timeline-item">
                            <div class="card">
                                <div class="card-actions">
                                    <div class="btn-icon-action" onclick="openModal('spot', ${dayIdx}, ${itemIdx}, true)"><i class="fas fa-pen"></i></div>
                                    <div class="btn-icon-action delete" onclick="deleteItem(${dayIdx}, ${itemIdx})"><i class="fas fa-trash-alt"></i></div>
                                </div>
                                <div class="card-body">
                                    <div class="card-title">${item.title}</div>
                                    ${badgeHtml}
                                    <div class="card-desc">${item.desc}</div>
                                    ${item.link ? `<a href="${item.link}" target="_blank" class="btn-map">Â∞éËà™</a>` : ''}
                                </div>
                            </div>
                        </div>`;
                    } else if (item.type === 'transit') {
                        html += `
                        <div class="transit-container">
                            <div class="transit-info">
                                <i class="fas ${item.icon} transit-icon"></i>
                                <span>${item.text}</span>
                            </div>
                            <div class="transit-actions">
                                <i class="fas fa-pen" onclick="openModal('transit', ${dayIdx}, ${itemIdx}, true)"></i>
                                <i class="fas fa-trash-alt" onclick="deleteItem(${dayIdx}, ${itemIdx})"></i>
                            </div>
                        </div>`;
                    }
                });

                html += `</div>
                    <div class="add-buttons-container">
                        <div class="btn-add-trip" onclick="openModal('spot', ${dayIdx})"><i class="fas fa-plus"></i> Êñ∞Â¢ûÊôØÈªû</div>
                    </div>`;
                container.innerHTML = html;
            });
            localStorage.setItem(ITINERARY_KEY, JSON.stringify(itineraryData));
        }

        function deleteItem(d, i) { if(confirm("Âà™Èô§Ê≠§È†ÖÁõÆÔºü")) { itineraryData[d].items.splice(i, 1); renderItinerary(); } }

        // --- Render Shopping ---
        function renderShop() {
            const con = document.getElementById('shopping-list-container'); con.innerHTML = '';
            shopData.forEach((item, idx) => {
                let noteHtml = item.note ? `<div class="shop-note"><i class="fas fa-sticky-note"></i> ${item.note}</div>` : '';
                let linkHtml = item.link ? `<a href="${item.link}" target="_blank" class="btn-link"><i class="fas fa-map-marker-alt"></i></a>` : '';
                con.innerHTML += `
                <div class="shop-item ${item.checked?'checked':''}">
                    <div style="flex:1"><div class="shop-name">${item.name}</div>${noteHtml}</div>
                    <div class="shop-actions">${linkHtml}<i class="fas fa-check-circle btn-check" onclick="toggleShop(${idx})"></i><i class="fas fa-trash-alt btn-trash" onclick="delShop(${idx})"></i></div>
                </div>`;
            });
            localStorage.setItem(SHOP_KEY, JSON.stringify(shopData));
        }
        function toggleShop(i){ shopData[i].checked=!shopData[i].checked; renderShop(); }
        function delShop(i){ if(confirm('Âà™Èô§?')){ shopData.splice(i,1); renderShop(); } }

        // --- Render Expense ---
        let rate = 0.22;
        function renderExp() {
            const list=document.getElementById('expense-list'); list.innerHTML=''; let total=0;
            expenses.forEach((e,i)=>{
                let twd=Math.round(e.amt*rate); total+=twd;
                list.innerHTML+=`<div class="list-item"><div><div style="font-weight:bold">${e.name}</div><div style="font-size:0.8rem;color:#666">¬•${e.amt}</div></div><div style="display:flex;align-items:center;gap:10px"><div style="font-weight:bold;color:var(--accent-pink)">NT$${twd}</div><i class="fas fa-trash-alt" style="color:#aaa;cursor:pointer" onclick="delExp(${i})"></i></div></div>`;
            });
            document.getElementById('total-twd').innerText=total.toLocaleString();
            localStorage.setItem(EXP_KEY, JSON.stringify(expenses));
        }
        function delExp(i){ if(confirm('Âà™Èô§?')){ expenses.splice(i,1); renderExp(); } }

        // --- Modal Logic ---
        function openModal(mode, d = null, i = null, isEdit = false) {
            currentModalMode = mode;
            editTarget = { d, i, isEdit }; 
            
            ['spot', 'transit', 'shopping', 'expense'].forEach(f => document.getElementById(`modal-fields-${f}`).style.display = 'none');
            document.getElementById(`modal-fields-${mode}`).style.display = 'block';
            
            const titleMap = { 'spot':'Á∑®ËºØ/Êñ∞Â¢ûÊôØÈªû', 'transit':'Á∑®ËºØ/Êñ∞Â¢û‰∫§ÈÄö', 'shopping':'Êñ∞Â¢ûË≥ºË≤∑Ê∏ÖÂñÆ', 'expense':'Êñ∞Â¢ûÊîØÂá∫' };
            document.getElementById('uni-modal-title').innerText = titleMap[mode];

            if (mode === 'spot') {
                if(isEdit) {
                    const item = itineraryData[d].items[i];
                    document.getElementById('spot-title').value = item.title;
                    document.getElementById('spot-score').value = item.score || '';
                    document.getElementById('spot-desc').value = item.desc;
                    document.getElementById('spot-link').value = item.link;
                } else {
                    document.getElementById('spot-title').value = ''; 
                    document.getElementById('spot-score').value = '';
                    document.getElementById('spot-desc').value = ''; 
                    document.getElementById('spot-link').value = '';
                }
            } else if (mode === 'transit') {
                if(isEdit) {
                    const item = itineraryData[d].items[i];
                    document.getElementById('transit-icon').value = item.icon;
                    document.getElementById('transit-text').value = item.text;
                } else {
                    document.getElementById('transit-icon').value = 'fa-car';
                    document.getElementById('transit-text').value = '';
                }
            } else if (mode === 'shopping') {
                document.getElementById('shop-modal-name').value = '';
                document.getElementById('shop-modal-note').value = '';
                document.getElementById('shop-modal-link').value = '';
            } else if (mode === 'expense') {
                document.getElementById('exp-modal-name').value = '';
                document.getElementById('exp-modal-amt').value = '';
            }

            document.getElementById('universal-modal').classList.add('show');
        }

        function closeModal() { document.getElementById('universal-modal').classList.remove('show'); }

        function saveModalData() {
            const { d, i, isEdit } = editTarget;

            if (currentModalMode === 'spot') {
                const newItem = {
                    type: 'spot',
                    title: document.getElementById('spot-title').value,
                    score: document.getElementById('spot-score').value,
                    desc: document.getElementById('spot-desc').value,
                    link: document.getElementById('spot-link').value
                };
                if (isEdit) itineraryData[d].items[i] = newItem;
                else itineraryData[d].items.push(newItem);
                renderItinerary();

            } else if (currentModalMode === 'transit') {
                const newItem = {
                    type: 'transit',
                    icon: document.getElementById('transit-icon').value,
                    text: document.getElementById('transit-text').value
                };
                if (isEdit) itineraryData[d].items[i] = newItem;
                else {
                    if (i !== null && i !== undefined) itineraryData[d].items.splice(i, 0, newItem);
                    else itineraryData[d].items.push(newItem);
                }
                renderItinerary();

            } else if (currentModalMode === 'shopping') {
                const name = document.getElementById('shop-modal-name').value;
                if(name) {
                    shopData.push({
                        name: name,
                        note: document.getElementById('shop-modal-note').value,
                        link: document.getElementById('shop-modal-link').value,
                        checked: false
                    });
                    renderShop();
                }

            } else if (currentModalMode === 'expense') {
                const name = document.getElementById('exp-modal-name').value;
                const amt = document.getElementById('exp-modal-amt').value;
                if(name && amt) {
                    expenses.unshift({name, amt});
                    renderExp();
                }
            }
            closeModal();
        }

        // --- Other Utils ---
        function createFallingEffect() { const c=document.getElementById('falling-container'); for(let i=0;i<30;i++){ const e=document.createElement('i'); e.className='falling-item fas '+(Math.random()>.5?'fa-snowflake snowflake':'fa-leaf sakura'); e.style.left=Math.random()*100+'%'; e.style.animationDuration=(Math.random()*5+5)+'s'; e.style.animationDelay=(Math.random()*-10)+'s'; e.style.fontSize=(Math.random()*10+10)+'px'; c.appendChild(e); } }
        function switchTab(id, el) { document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active')); el.classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}); }
        function startJourney() { switchTab('flight', document.querySelectorAll('.nav-item')[1]); }
        
        function renderCheck(){ const c=document.getElementById('checklist-container'); c.innerHTML=''; checks.forEach((k,i)=>{ c.innerHTML+=`<div class="list-item" style="${k.checked?'opacity:0.5':''}"><div style="flex:1;display:flex;align-items:center;cursor:pointer" onclick="toggleCheck(${i})"><i class="fas ${k.checked?'fa-check-circle':'fa-circle'}" style="margin-right:10px;color:var(--accent-pink)"></i><span style="${k.checked?'text-decoration:line-through':''}">${k.text}</span></div><i class="fas fa-trash-alt" style="color:#aaa" onclick="delCheck(${i})"></i></div>`; }); localStorage.setItem(CHECK_KEY,JSON.stringify(checks)); }
        function addChecklistItem(){ const v=document.getElementById('check-new').value; if(v){ checks.push({text:v,checked:false}); document.getElementById('check-new').value=''; renderCheck(); } }
        function toggleCheck(i){ checks[i].checked=!checks[i].checked; renderCheck(); } function delCheck(i){ if(confirm('Âà™Èô§?')){ checks.splice(i,1); renderCheck(); } }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                createFallingEffect();
                renderItinerary();
                renderShop();
                renderExp();
                renderCheck();
                const rateInput = document.getElementById('exchange-rate');
                if(rateInput) rateInput.addEventListener('change', function(){ rate=this.value; renderExp(); });
            } catch(e) {
                console.error("Init Error:", e);
                alert("ÂàùÂßãÂåñÂ§±ÊïóÔºåË´ãÊ∏ÖÈô§ÁÄèË¶ΩÂô®Âø´ÂèñÈáçË©¶");
            }
        });
    </script>
</body>
</html>
